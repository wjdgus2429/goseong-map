<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>고성 직업MAP</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100vh;
    }

    /* 상단 검색/필터 영역 전체 */
    #ui-wrapper {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-family: sans-serif;
      font-size: 14px;
      min-width: 320px;
      max-width: 520px;
    }

    /* 검색 박스 */
    #search-box {
      background: rgba(255, 255, 255, 0.95);
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: flex;
      gap: 6px;
      align-items: center;
    }
    #search-input {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px 8px;
      min-width: 220px;
      flex: 1;
    }
    #search-button {
      border: none;
      border-radius: 4px;
      padding: 4px 10px;
      background: #4a90e2;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }
    #search-button:hover {
      background: #3577c5;
    }

    /* 산업 필터 버튼들 */
    #industry-filter {
      background: rgba(255, 255, 255, 0.95);
      padding: 6px 10px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .industry-btn {
      border: 1px solid #ccc;
      border-radius: 16px;
      padding: 4px 10px;
      background: #f7f7f7;
      cursor: pointer;
      font-size: 13px;
      white-space: nowrap;
    }
    .industry-btn.active {
      background: #4a90e2;
      border-color: #4a90e2;
      color: white;
      font-weight: 600;
    }
  </style>

  <!-- Kakao Map SDK -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=3ef40c514a8e54dbb7fdb040363526ad&autoload=false"></script>
</head>
<body>

  <!-- 상단 UI (검색 + 산업 필터) -->
  <div id="ui-wrapper">
    <!-- 기업명 검색 -->
    <div id="search-box">
      <span>기업 검색:</span>
      <input id="search-input" type="text" placeholder="기업명을 입력하세요" />
      <button id="search-button">검색</button>
    </div>

    <!-- 산업 필터 -->
    <div id="industry-filter">
      <button class="industry-btn" data-industry="">전체</button>
      <button class="industry-btn" data-industry="ship">조선·해양</button>
      <button class="industry-btn" data-industry="aero">우주·항공</button>
      <button class="industry-btn" data-industry="craft">공예·공방</button>
      <button class="industry-btn" data-industry="tradition">전통·예술</button>
      <button class="industry-btn" data-industry="agri">6차산업</button>
    </div>
  </div>

  <!-- 지도 -->
  <div id="map"></div>

  <script>
    // 1) 기업 데이터
    const companies = [
      {
        industry: "aero",
        industryName: "우주·항공",
        name: "KAI(한국항공우주산업)",
        lat: 34.9781625980645,
        lng: 128.29042206421983
      },
      {
        industry: "ship",
        industryName: "조선·해양",
        name: "EK중공업",
        lat: 35.011319508463835,
        lng: 128.48268869165898
      },
      {
        industry: "ship",
        industryName: "조선·해양",
        name: "SK오션플랜트",
        lat: 35.05193447409189,
        lng: 128.47723012735116
      },
      {
        industry: "ship",
        industryName: "조선·해양",
        name: "삼강S&C",
        lat: 34.99369305057122,
        lng: 128.46167095183077
      },
      {
        industry: "craft",
        industryName: "공예·공방",
        name: "엄마손공방",
        lat: 34.97596206764501,
        lng: 128.31615596063517
      },
      {
        industry: "tradition",
        industryName: "전통·예술",
        name: "고성오광대보존회",
        lat: 34.973605070659815,
        lng: 128.33412518499514
      },
      {
        industry: "agri",
        industryName: "6차산업",
        name: "정동목장교육농장",
        lat: 35.122873160327366,
        lng: 128.26343036412558
      }
    ];

    let map;
    let currentMarkers = [];

    // 상태값: 선택된 산업 & 검색어
    let currentIndustry = "";   // "", "ship", "aero", ...
    let currentKeyword = "";    // 기업명 검색어

    window.onload = function () {
      kakao.maps.load(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const industryParam = urlParams.get("industry");
        if (industryParam) {
          currentIndustry = industryParam;
        }

        const mapContainer = document.getElementById("map");
        const mapOption = {
          center: new kakao.maps.LatLng(34.99, 128.35),
          level: 10
        };
        map = new kakao.maps.Map(mapContainer, mapOption);

        setupIndustryButtons();
        setupSearch();

        // 초기 렌더링
        renderMarkers(getFilteredData());
      });
    };

    // 현재 상태(currentIndustry, currentKeyword)에 따라 데이터 필터링
    function getFilteredData() {
      let data = companies;

      if (currentIndustry) {
        data = data.filter(c => c.industry === currentIndustry);
      }

      if (currentKeyword) {
        const kw = currentKeyword.toLowerCase();
        data = data.filter(c =>
          c.name.toLowerCase().includes(kw)
        );
      }

      return data;
    }

    // 마커 그리기
    function renderMarkers(data) {
      currentMarkers.forEach(m => m.marker.setMap(null));
      currentMarkers = [];

      if (data.length === 0) return;

      data.forEach(company => {
        const position = new kakao.maps.LatLng(company.lat, company.lng);

        const marker = new kakao.maps.Marker({
          position,
          map
        });

        const infowindow = new kakao.maps.InfoWindow({
          content: `
            <div style="padding:5px 10px; font-size:14px;">
              <b>${company.name}</b><br/>
              ${company.industryName}
            </div>
          `
        });

        kakao.maps.event.addListener(marker, "click", function () {
          infowindow.open(map, marker);
        });

        currentMarkers.push({ marker, company });
      });

      const first = data[0];
      map.setCenter(new kakao.maps.LatLng(first.lat, first.lng));
    }

    // 산업 버튼 세팅
    function setupIndustryButtons() {
      const buttons = document.querySelectorAll(".industry-btn");

      buttons.forEach(btn => {
        const code = btn.getAttribute("data-industry");

        // URL 파라미터로 넘어온 값에 맞춰 초기 active 지정
        if (code === currentIndustry || (currentIndustry === "" && code === "")) {
          btn.classList.add("active");
        }

        btn.addEventListener("click", function () {
          // active 표시 변경
          buttons.forEach(b => b.classList.remove("active"));
          this.classList.add("active");

          // 상태 갱신
          currentIndustry = code; // ""이면 전체

          // 필터 다시 적용
          renderMarkers(getFilteredData());
        });
      });
    }

    // 검색 세팅
    function setupSearch() {
      const input = document.getElementById("search-input");
      const button = document.getElementById("search-button");

      function doSearch() {
        currentKeyword = input.value.trim();
        renderMarkers(getFilteredData());
      }

      button.addEventListener("click", doSearch);

      input.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          doSearch();
        }
      });
    }
  </script>
</body>
</html>
